AWSTemplateFormatVersion: 2010-09-09
Description: >-
  This template deploys a high availability pair of BIG-IPs and demo applications **WARNING**
  This template creates multiple AWS resources including the S3 bucket, IAM
  roles, and other related resources. You will be billed for the AWS resources used if you
  create a stack from this template.(qs-1p2474b6a)
Mappings:
  AWSBigipThroughput:
    1000Mbps:
      AllTwoBootLocations: AllTwoBootLocations
      Best: Best1000Mbps
    200Mbps:
      AdvancedWaf: AdvancedWaf200Mbps
      AllTwoBootLocations: AllTwoBootLocations
      Best: Best200Mbps
    25Mbps:
      AdvancedWaf: AdvancedWaf25Mbps
      AllTwoBootLocations: AllTwoBootLocations
      Best: Best25Mbps
    3000Mbps:
      AdvancedWaf: AdvancedWaf3000Mbps
      AllTwoBootLocations: AllTwoBootLocations
    5000Mbps:
      AllTwoBootLocations: AllTwoBootLocations
      Best: Best5000Mbps
    10000Mbps:
      AllTwoBootLocations: AllTwoBootLocations
      Best: Best10000Mbps
  VERSION:
    16-1-2-1-0010:
      REGIONMAP: TMOS161210010
    14-1-4-5-007:
      REGIONMAP: TMOS14145007
  TMOS161210010:
    af-south-1:
      AdvancedWaf200Mbps: ami-0780a2f4f0dcc370c
      AdvancedWaf25Mbps: ami-016627175d4256a6a
      AdvancedWaf3000Mbps: ami-06dff7310df9e2a34
      AllTwoBootLocations: ami-0f671f966a041912b
      Best10000Mbps: ami-0bcdedf2b75173395
      Best1000Mbps: ami-039569f01d1b66fa9
      Best200Mbps: ami-0819a7f10ce76fc5a
      Best25Mbps: ami-00af081df73bd58dc
      Best5000Mbps: ami-0dfd667fd41fb6d46
    ap-east-1:
      AdvancedWaf200Mbps: ami-0112bb029d176be5c
      AdvancedWaf25Mbps: ami-0427958315bc886f2
      AdvancedWaf3000Mbps: ami-0985147f7920ed542
      AllTwoBootLocations: ami-0bba3021f7d664f38
      Best10000Mbps: ami-03a50078f74846458
      Best1000Mbps: ami-0ca29584f0e22cbe3
      Best200Mbps: ami-082c29f2bea9ef305
      Best25Mbps: ami-087d9ae12a5cd03d4
      Best5000Mbps: ami-081d4fac3ba20f64a
    ap-northeast-1:
      AdvancedWaf200Mbps: ami-013590344850f0c4a
      AdvancedWaf25Mbps: ami-05662ecab2d7939ee
      AdvancedWaf3000Mbps: ami-0a555c565bf5326ab
      AllTwoBootLocations: ami-0b26097d09ae8ad39
      Best10000Mbps: ami-05b3f023f8c88810b
      Best1000Mbps: ami-065b43404d34cd469
      Best200Mbps: ami-00911be4e164e0f9a
      Best25Mbps: ami-01342b8b47ebf955b
      Best5000Mbps: ami-08173c7492280e175
    ap-northeast-2:
      AdvancedWaf200Mbps: ami-0ae525fffd78f3a8a
      AdvancedWaf25Mbps: ami-09ac037daaff3b089
      AdvancedWaf3000Mbps: ami-0417cd39efa683a29
      AllTwoBootLocations: ami-00207878ee339e6d1
      Best10000Mbps: ami-01d3349c6c8e54856
      Best1000Mbps: ami-00e75dd170ed3edec
      Best200Mbps: ami-017e7556782db473d
      Best25Mbps: ami-00e86904125f71c9b
      Best5000Mbps: ami-0450fa170416cbaf2
    ap-northeast-3:
      AdvancedWaf200Mbps: ami-044ee4376e7814feb
      AdvancedWaf25Mbps: ami-05e802030f6d6405a
      AdvancedWaf3000Mbps: ami-08d4a60e93ce1e5ee
      AllTwoBootLocations: ami-0088a23a11de87334
      Best10000Mbps: ami-092772b2906a1563d
      Best1000Mbps: ami-00b02a610a9490310
      Best200Mbps: ami-03362ef762adf2d5a
      Best25Mbps: ami-0084558cdcae84ddf
      Best5000Mbps: ami-01d7c9df2c802ccb4
    ap-south-1:
      AdvancedWaf200Mbps: ami-0ea7cdac800173b38
      AdvancedWaf25Mbps: ami-0583e518a6b41a2bf
      AdvancedWaf3000Mbps: ami-01decfe09630d0181
      AllTwoBootLocations: ami-092592f077725f109
      Best10000Mbps: ami-03edbb049df94b62d
      Best1000Mbps: ami-0233fbce39fe77d0b
      Best200Mbps: ami-06b5a9e4b947a826e
      Best25Mbps: ami-0558a5ae384731855
      Best5000Mbps: ami-013785c3a14ff0599
    ap-southeast-1:
      AdvancedWaf200Mbps: ami-0cfa11d98b04ce46c
      AdvancedWaf25Mbps: ami-067c9831fd21f50cc
      AdvancedWaf3000Mbps: ami-0e519ec586ce890ed
      AllTwoBootLocations: ami-0efe84ab3d6227ef1
      Best10000Mbps: ami-022345ac4c9428821
      Best1000Mbps: ami-0e91ac17cab710888
      Best200Mbps: ami-054bb9553ea481b13
      Best25Mbps: ami-03ffd03bbca5b89b1
      Best5000Mbps: ami-02dc666f2e7eaeb2c
    ap-southeast-2:
      AdvancedWaf200Mbps: ami-074a7000cb2b0c616
      AdvancedWaf25Mbps: ami-00a58fea2fb06c361
      AdvancedWaf3000Mbps: ami-0fe74b69752b30dba
      AllTwoBootLocations: ami-00880544550382f79
      Best10000Mbps: ami-01c9632e464588516
      Best1000Mbps: ami-010d0644e071aeed3
      Best200Mbps: ami-01415a9a471ba33dd
      Best25Mbps: ami-0678c527580fa2725
      Best5000Mbps: ami-0448333989516a25b
    ca-central-1:
      AdvancedWaf200Mbps: ami-01db7b7c33a8deeb2
      AdvancedWaf25Mbps: ami-037f1c4f5fe3a9f25
      AdvancedWaf3000Mbps: ami-0d487534c26d73cd7
      AllTwoBootLocations: ami-0152ab270e5151f5a
      Best10000Mbps: ami-080db530a5f6c1019
      Best1000Mbps: ami-03452b36312913a08
      Best200Mbps: ami-0ba0f7c733d48efac
      Best25Mbps: ami-0bbc529047f005ce8
      Best5000Mbps: ami-044c9570c5950b123
    eu-central-1:
      AdvancedWaf200Mbps: ami-03dbd3c5f31c60ac9
      AdvancedWaf25Mbps: ami-0a0a89c3c0dd4a795
      AdvancedWaf3000Mbps: ami-0e53524689e061810
      AllTwoBootLocations: ami-014eacad6833100d6
      Best10000Mbps: ami-0498bcf52eff435eb
      Best1000Mbps: ami-0d4801f0b470873d6
      Best200Mbps: ami-003e16d42da4fb223
      Best25Mbps: ami-03790a502a008cb38
      Best5000Mbps: ami-0393c6509ee5b6a4b
    eu-north-1:
      AdvancedWaf200Mbps: ami-0b563afed7c6a11c8
      AdvancedWaf25Mbps: ami-07a5500b732a17313
      AdvancedWaf3000Mbps: ami-0f6938498b2bd7663
      AllTwoBootLocations: ami-0ab6e1a5562f04426
      Best10000Mbps: ami-02e54ee18462643e4
      Best1000Mbps: ami-03904bbce91b7d28f
      Best200Mbps: ami-072cef7964a3a4244
      Best25Mbps: ami-01ac8c8a28290985c
      Best5000Mbps: ami-0560ace7048641f48
    eu-south-1:
      AdvancedWaf200Mbps: ami-06cbcaa3b7d6c9f90
      AdvancedWaf25Mbps: ami-0dcfd32aa7fe29df4
      AdvancedWaf3000Mbps: ami-0a6007b00579e12f7
      AllTwoBootLocations: ami-09d1d292ffc83d28b
      Best10000Mbps: ami-02a1e95dfe8708d5c
      Best1000Mbps: ami-00e4fa693b20b5903
      Best200Mbps: ami-033a9c41cbb1bcbcc
      Best25Mbps: ami-0cb4c29901b82b809
      Best5000Mbps: ami-094e8c7f88bcbfda6
    eu-west-1:
      AdvancedWaf200Mbps: ami-01ba32ebfba5dc087
      AdvancedWaf25Mbps: ami-0d31530a991cfdfcf
      AdvancedWaf3000Mbps: ami-0baea0b00bd3dfbec
      AllTwoBootLocations: ami-0b3c6136073fcd322
      Best10000Mbps: ami-06d98c0d84121fa7d
      Best1000Mbps: ami-066623796907bc13f
      Best200Mbps: ami-00e73e77e0ab8887b
      Best25Mbps: ami-03c6545981e4c344d
      Best5000Mbps: ami-05e36687e7bdc3868
    eu-west-2:
      AdvancedWaf200Mbps: ami-04de2d9f55093d557
      AdvancedWaf25Mbps: ami-0f330b34e6bb62b35
      AdvancedWaf3000Mbps: ami-0365471ab143312ae
      AllTwoBootLocations: ami-01bbe32f7a757cf86
      Best10000Mbps: ami-00550fe4c50630661
      Best1000Mbps: ami-015b6325fb23a2c66
      Best200Mbps: ami-038e0a944d7e6d048
      Best25Mbps: ami-001bbab746c994174
      Best5000Mbps: ami-05899a5aa6cc7131f
    eu-west-3:
      AdvancedWaf200Mbps: ami-019de472eba508e32
      AdvancedWaf25Mbps: ami-0187cfc2f500dad3b
      AdvancedWaf3000Mbps: ami-0ac0ac1817808297e
      AllTwoBootLocations: ami-03810d05d7ce8a2de
      Best10000Mbps: ami-0bda7b68d78cc6150
      Best1000Mbps: ami-04e3b085acbffc590
      Best200Mbps: ami-035f3155f83b875bd
      Best25Mbps: ami-07ec729998be9351d
      Best5000Mbps: ami-027f991d08b7b2f68
    me-south-1:
      AdvancedWaf200Mbps: ami-03291da8648c7e0fe
      AdvancedWaf25Mbps: ami-01a486e0983e8bf9b
      AdvancedWaf3000Mbps: ami-09b6b40bf760f5f90
      AllTwoBootLocations: ami-0fefe6c637f07ed4a
      Best10000Mbps: ami-0154a9181092bf077
      Best1000Mbps: ami-071370d9f61ad5c64
      Best200Mbps: ami-0a16232362eaa31da
      Best25Mbps: ami-00cdd90ad0c074e20
      Best5000Mbps: ami-0568731c8ac253f7c
    sa-east-1:
      AdvancedWaf200Mbps: ami-017eed031ff30d74f
      AdvancedWaf25Mbps: ami-08ae53fe11ce8519f
      AdvancedWaf3000Mbps: ami-0394ef012ad0c1033
      AllTwoBootLocations: ami-075af76663133d541
      Best10000Mbps: ami-06758792de4019c85
      Best1000Mbps: ami-0758cfe431711f65f
      Best200Mbps: ami-00ddc710486c7aa33
      Best25Mbps: ami-0c5c2838aa3887338
      Best5000Mbps: ami-034c1a53dcd39fc75
    us-east-1:
      AdvancedWaf200Mbps: ami-04f64528e4ec2e338
      AdvancedWaf25Mbps: ami-00d75b4219bdde22b
      AdvancedWaf3000Mbps: ami-016bd6e8f70ca4f47
      AllTwoBootLocations: ami-00e5f8a1ccd470b8a
      Best10000Mbps: ami-0d1c1efb0e81f3d8f
      Best1000Mbps: ami-08d7dce5a2b108ede
      Best200Mbps: ami-01a79c12d08c392de
      Best25Mbps: ami-0ce94feb4eff482da
      Best5000Mbps: ami-08c1dd06a4ba6a2ed
    us-east-2:
      AdvancedWaf200Mbps: ami-00139a1743c29e4ee
      AdvancedWaf25Mbps: ami-00b99be3cfeca2ee3
      AdvancedWaf3000Mbps: ami-0b05737ddc84f6ab3
      AllTwoBootLocations: ami-023a3dbde53a4dbcb
      Best10000Mbps: ami-03440972d30fb79a8
      Best1000Mbps: ami-0099ba5aecebad9d3
      Best200Mbps: ami-0c2f29fedd3b91673
      Best25Mbps: ami-026f260f147a28795
      Best5000Mbps: ami-059a09b1f8c90dcea
    us-gov-east-1:
      AdvancedWaf200Mbps: ami-06f992c6fd3167076
      AdvancedWaf25Mbps: ami-07c04a5a4c69bade0
      AdvancedWaf3000Mbps: ami-08a997a78de8c3839
      AllTwoBootLocations: ami-0508d0ddee9b35a2b
      Best10000Mbps: ami-0081adda7ca292150
      Best1000Mbps: ami-01a9d200b5f8ca790
      Best200Mbps: ami-0474d68fbb2dd387d
      Best25Mbps: ami-0d1680dc093c8a87a
      Best5000Mbps: ami-07442fa3240c2b59d
    us-gov-west-1:
      AdvancedWaf200Mbps: ami-018cd51280e129fcf
      AdvancedWaf25Mbps: ami-0636826f76665a577
      AdvancedWaf3000Mbps: ami-09fe429dd3d9a08bf
      AllTwoBootLocations: ami-0c619134432ca2781
      Best10000Mbps: ami-09f02d2f5fc6f8fbf
      Best1000Mbps: ami-0725328b436aba7cc
      Best200Mbps: ami-0bc3a599c32f4ca53
      Best25Mbps: ami-01e0e128106e99e8d
      Best5000Mbps: ami-01331cdf1c8ef5065
    us-west-1:
      AdvancedWaf200Mbps: ami-06ca58157a744efc5
      AdvancedWaf25Mbps: ami-0a4a03f1522800287
      AdvancedWaf3000Mbps: ami-0ccc1aa31b49198e7
      AllTwoBootLocations: ami-0f080642b23c55b36
      Best10000Mbps: ami-02ef59200a0d2e0c9
      Best1000Mbps: ami-0af63df6ec33b5f2e
      Best200Mbps: ami-09b80a0d083b800e8
      Best25Mbps: ami-01b6a29600dee3b06
      Best5000Mbps: ami-055e04688cd2f6d85
    us-west-2:
      AdvancedWaf200Mbps: ami-0df7038f809d8900d
      AdvancedWaf25Mbps: ami-0e677b5afee562f6e
      AdvancedWaf3000Mbps: ami-05023f822e5e21938
      AllTwoBootLocations: ami-0b58fbcc973de5e3b
      Best10000Mbps: ami-0165371074af9df0d
      Best1000Mbps: ami-088f468fad728c9c5
      Best200Mbps: ami-06bf3e6a4f585a4ec
      Best25Mbps: ami-00e7c3b9ba5e12e27
      Best5000Mbps: ami-009c4a2cc328432e6
  TMOS14145007:
    af-south-1:
      AdvancedWaf200Mbps: ami-0af30d66522364ad7
      AdvancedWaf25Mbps: ami-07dc7250900815728
      AdvancedWaf3000Mbps: ami-06f69d6d398d57a34
      AllTwoBootLocations: ami-0edd568fd059031b2
      Best10000Mbps: ami-09d10f4a9a349ecaf
      Best1000Mbps: ami-04983385dfa46642c
      Best200Mbps: ami-002112e36bf1e5f18
      Best25Mbps: ami-03ce2ef34af178fbf
      Best5000Mbps: ami-0fa498978d9a61d3d
    ap-east-1:
      AdvancedWaf200Mbps: ami-0cc82f727554a0938
      AdvancedWaf25Mbps: ami-07b10b352d0c91612
      AdvancedWaf3000Mbps: ami-0608b415cbf6ee4a8
      AllTwoBootLocations: ami-0ed657c0112bf14ed
      Best10000Mbps: ami-07d53c055533f7cfe
      Best1000Mbps: ami-00dbf43f6dc4c0fde
      Best200Mbps: ami-0c27096fea021c294
      Best25Mbps: ami-07d6a5e8b03fdc104
      Best5000Mbps: ami-03b489a639d9ade04
    ap-northeast-1:
      AdvancedWaf200Mbps: ami-04673ad0968a888ce
      AdvancedWaf25Mbps: ami-07ff50b5adad8e852
      AdvancedWaf3000Mbps: ami-02610ae7a0964af54
      AllTwoBootLocations: ami-043b8e5da13cd9027
      Best10000Mbps: ami-07c824a735710a642
      Best1000Mbps: ami-027ebd2a08687ae77
      Best200Mbps: ami-052aeab322587e2ff
      Best25Mbps: ami-02cbfd02c11239690
      Best5000Mbps: ami-093a2f8f6ac8f16dd
    ap-northeast-2:
      AdvancedWaf200Mbps: ami-01f46daf3acc321a0
      AdvancedWaf25Mbps: ami-0a64d5a0adb444f6d
      AdvancedWaf3000Mbps: ami-0efd29d4f2c3cdd08
      AllTwoBootLocations: ami-0cf1ce25450bb07c4
      Best10000Mbps: ami-090cfe5ee7190b0ef
      Best1000Mbps: ami-04c7f45545b1b4521
      Best200Mbps: ami-01cfe28ec96e2e6ed
      Best25Mbps: ami-07021de1606c4957a
      Best5000Mbps: ami-088704ff717d3ac01
    ap-northeast-3:
      AdvancedWaf200Mbps: ami-045641b3105d541b8
      AdvancedWaf25Mbps: ami-08c2dffc82afc489f
      AdvancedWaf3000Mbps: ami-0ffbdb54be211f545
      AllTwoBootLocations: ami-07856213399e76a77
      Best10000Mbps: ami-0108c8ee9fccda0c9
      Best1000Mbps: ami-05490e3dfb264b603
      Best200Mbps: ami-0b6836380f754d4ad
      Best25Mbps: ami-06ef65c8ce8c072ea
      Best5000Mbps: ami-01077f9bff07a3c5e
    ap-south-1:
      AdvancedWaf200Mbps: ami-0a0f85492726288e2
      AdvancedWaf25Mbps: ami-084e7fb1439f8a288
      AdvancedWaf3000Mbps: ami-0d311be746148384e
      AllTwoBootLocations: ami-0aef83a9ef4ceac06
      Best10000Mbps: ami-0d3ee3e9b70de6526
      Best1000Mbps: ami-01dfabce353cbf720
      Best200Mbps: ami-063728ecc5c625247
      Best25Mbps: ami-01183a880821a88e0
      Best5000Mbps: ami-01ffa50432f5a2234
    ap-southeast-1:
      AdvancedWaf200Mbps: ami-099fb6cbdc4ad5423
      AdvancedWaf25Mbps: ami-0f589a709272b3ac4
      AdvancedWaf3000Mbps: ami-004b0588dfb94f31b
      AllTwoBootLocations: ami-0b12c25e1ab22f717
      Best10000Mbps: ami-01d816bd8d4e08f45
      Best1000Mbps: ami-04d2ba81592b2a364
      Best200Mbps: ami-0052f390a0d41552d
      Best25Mbps: ami-094f641ece703d121
      Best5000Mbps: ami-0dab539b2dd59df19
    ap-southeast-2:
      AdvancedWaf200Mbps: ami-0657c73e3ca1417d2
      AdvancedWaf25Mbps: ami-0ad2afa1ecd6688b1
      AdvancedWaf3000Mbps: ami-08686662de42adac0
      AllTwoBootLocations: ami-06e34505d50773e99
      Best10000Mbps: ami-016f86b3107f191f1
      Best1000Mbps: ami-087ee3eb735b6eecc
      Best200Mbps: ami-0599c4afcc0ddacf8
      Best25Mbps: ami-019e9044f49d2f309
      Best5000Mbps: ami-02322af68a3bdbfb2
    ca-central-1:
      AdvancedWaf200Mbps: ami-0c123e4056050e0cf
      AdvancedWaf25Mbps: ami-0962e7bf484d97461
      AdvancedWaf3000Mbps: ami-0351c996a57b789be
      AllTwoBootLocations: ami-0f68fe8385fd43ea3
      Best10000Mbps: ami-09b8b5499c99033e8
      Best1000Mbps: ami-00e2d9107944c9258
      Best200Mbps: ami-0995dab1159c6bde1
      Best25Mbps: ami-067b434a61dbecf41
      Best5000Mbps: ami-03408d65a485ce6fc
    eu-central-1:
      AdvancedWaf200Mbps: ami-0013827ffdb8a3d65
      AdvancedWaf25Mbps: ami-0902ee60e26fd184b
      AdvancedWaf3000Mbps: ami-07b378954ccbb79d7
      AllTwoBootLocations: ami-01050e8290ceede3d
      Best10000Mbps: ami-087842f5457af7198
      Best1000Mbps: ami-022f169159b475077
      Best200Mbps: ami-0c676a0ecb482c9a1
      Best25Mbps: ami-06418f6f77ef84434
      Best5000Mbps: ami-004357bbefb0ce083
    eu-north-1:
      AdvancedWaf200Mbps: ami-0e27d44a7b1fdf42a
      AdvancedWaf25Mbps: ami-0e31b170adac2f9f3
      AdvancedWaf3000Mbps: ami-0166ecda03cccd15a
      AllTwoBootLocations: ami-01d8373c5b283b1fc
      Best10000Mbps: ami-06adcee1b2384b4a6
      Best1000Mbps: ami-06a98647a08512fc9
      Best200Mbps: ami-07a77a5bfad877c23
      Best25Mbps: ami-06438f70f24cc4c5b
      Best5000Mbps: ami-05a0980ac4465a881
    eu-south-1:
      AdvancedWaf200Mbps: ami-09b880c45d266c3aa
      AdvancedWaf25Mbps: ami-0588b0d86c3d7b09a
      AdvancedWaf3000Mbps: ami-001f93b315e9d8454
      AllTwoBootLocations: ami-08b66b44b33f38a90
      Best10000Mbps: ami-0f078140c26fa7041
      Best1000Mbps: ami-0fa58a1959a0d038a
      Best200Mbps: ami-0378dc3d3f4b95eda
      Best25Mbps: ami-0b53c74f94f951c67
      Best5000Mbps: ami-02b238715333323f2
    eu-west-1:
      AdvancedWaf200Mbps: ami-052524da256ecb304
      AdvancedWaf25Mbps: ami-081f694628fa177c2
      AdvancedWaf3000Mbps: ami-0eae9b78fb0d22143
      AllTwoBootLocations: ami-070041b6fc1ad2580
      Best10000Mbps: ami-0009670572120a2e7
      Best1000Mbps: ami-0a6b35b5502fdb85a
      Best200Mbps: ami-00c9bcc00f5d9dfbc
      Best25Mbps: ami-0d3b53c7a014900c3
      Best5000Mbps: ami-09db05b7ea55aea99
    eu-west-2:
      AdvancedWaf200Mbps: ami-00a55801dd85fc3a3
      AdvancedWaf25Mbps: ami-09d77f0895a55b266
      AdvancedWaf3000Mbps: ami-0b3859225cfdc701e
      AllTwoBootLocations: ami-0874d67a1b92cf088
      Best10000Mbps: ami-08cf8115bf9d739e4
      Best1000Mbps: ami-034cb9232db4e991a
      Best200Mbps: ami-05ee2efd90d0612b3
      Best25Mbps: ami-078806adc0e98e18b
      Best5000Mbps: ami-04be58a1a7ae64536
    eu-west-3:
      AdvancedWaf200Mbps: ami-01e9b815414fca606
      AdvancedWaf25Mbps: ami-0219161de86350fd4
      AdvancedWaf3000Mbps: ami-0eb855620e0110fc0
      AllTwoBootLocations: ami-01b995d67e175ad29
      Best10000Mbps: ami-003f705ff719039fb
      Best1000Mbps: ami-017aa97ddad7bf1fd
      Best200Mbps: ami-05c3a630ceb55e7e4
      Best25Mbps: ami-0ccc832ee49732757
      Best5000Mbps: ami-03107029ac1bb7b06
    me-south-1:
      AdvancedWaf200Mbps: ami-038a82012412de2fa
      AdvancedWaf25Mbps: ami-04433d95d8fe5bb1d
      AdvancedWaf3000Mbps: ami-0d98ac6295a415bd9
      AllTwoBootLocations: ami-02be01115c2de47ba
      Best10000Mbps: ami-0bcaf7008f55e2f5a
      Best1000Mbps: ami-020769786e468360c
      Best200Mbps: ami-0256748b0cfa3e28f
      Best25Mbps: ami-05e7df24b5fe69757
      Best5000Mbps: ami-0aedb3102d860e7a8
    sa-east-1:
      AdvancedWaf200Mbps: ami-0ff6ac460cd8f94a3
      AdvancedWaf25Mbps: ami-0ee6b34f3f8d35eb8
      AdvancedWaf3000Mbps: ami-091b45011afce91a6
      AllTwoBootLocations: ami-042b2d34dafee1057
      Best10000Mbps: ami-0a6880242e13b7853
      Best1000Mbps: ami-01860dba391877e0a
      Best200Mbps: ami-012372c6ce0caee55
      Best25Mbps: ami-0516b15a670c22c7b
      Best5000Mbps: ami-000c20a7849b2e984
    us-east-1:
      AdvancedWaf200Mbps: ami-05b9d54f40833c46d
      AdvancedWaf25Mbps: ami-07e6bf1cb9cefc44a
      AdvancedWaf3000Mbps: ami-06cf9dbd71b90bccc
      AllTwoBootLocations: ami-0319a4b07d1ca7db7
      Best10000Mbps: ami-0873f7ae105d7a849
      Best1000Mbps: ami-0167afeffa4549244
      Best200Mbps: ami-0727e25aa4ad98901
      Best25Mbps: ami-053c74da7dcd1e1f5
      Best5000Mbps: ami-02f694c9970e0f5eb
    us-east-2:
      AdvancedWaf200Mbps: ami-0964f0dd943359803
      AdvancedWaf25Mbps: ami-0b8dadedb4b5768dc
      AdvancedWaf3000Mbps: ami-0060dd4d7fdf142ba
      AllTwoBootLocations: ami-029e1742526500628
      Best10000Mbps: ami-04746ccdd2bd6a587
      Best1000Mbps: ami-024918b274271dea4
      Best200Mbps: ami-05e59e59757b71dfe
      Best25Mbps: ami-09729d04bc4728720
      Best5000Mbps: ami-0187b76b0ce2cefad
    us-gov-east-1:
      AdvancedWaf200Mbps: ami-0082930eae4efbc7d
      AdvancedWaf25Mbps: ami-0f5d5dcf5648f4efc
      AdvancedWaf3000Mbps: ami-042d48b3db59a3793
      AllTwoBootLocations: ami-0ac19f407fb084d2c
      Best10000Mbps: ami-0802a83fd69835ec5
      Best1000Mbps: ami-00ef0a70bb3b9e9ab
      Best200Mbps: ami-00bbb9463bc817a8e
      Best25Mbps: ami-00174bdb809b70a1c
      Best5000Mbps: ami-027c9c113cec72c86
    us-gov-west-1:
      AdvancedWaf200Mbps: ami-0338baf4d17578819
      AdvancedWaf25Mbps: ami-09c8b4b664aeaa47d
      AdvancedWaf3000Mbps: ami-0db9b0c00c25ce1e7
      AllTwoBootLocations: ami-0254e59fd7caf0a46
      Best10000Mbps: ami-018c4ae2d7b681679
      Best1000Mbps: ami-0ac2ab1cec5bda257
      Best200Mbps: ami-0ba7c704a0d1036ec
      Best25Mbps: ami-06b8fe5a835e4378d
      Best5000Mbps: ami-021aa8af1ea0477c7
    us-west-1:
      AdvancedWaf200Mbps: ami-03815793a7d19d016
      AdvancedWaf25Mbps: ami-0d684b9197c49fb7f
      AdvancedWaf3000Mbps: ami-010c23200b2ebe59a
      AllTwoBootLocations: ami-06482401fdffa6b18
      Best10000Mbps: ami-061a938596057fd0b
      Best1000Mbps: ami-021e6b31ff3592fc0
      Best200Mbps: ami-01c63878c02656dbd
      Best25Mbps: ami-08a6c4bae629a3375
      Best5000Mbps: ami-011a90ae8cd15cdd4
    us-west-2:
      AdvancedWaf200Mbps: ami-028a334c1243b2973
      AdvancedWaf25Mbps: ami-0f16ef72e013cdef5
      AdvancedWaf3000Mbps: ami-031fe3a3e4c6bd213
      AllTwoBootLocations: ami-09373fc1b96b1c954
      Best10000Mbps: ami-01413e1235d8dceab
      Best1000Mbps: ami-00ecae334d47bc41c
      Best200Mbps: ami-08984ccc150732e29
      Best25Mbps: ami-0484e65be7b1a7fa3
      Best5000Mbps: ami-048dc847bff912f4e
Conditions:
  CustomConfig1: !Not [!Equals [!Ref CustomBigIPRuntimeInit01, ""]]
  CustomConfig2: !Not [!Equals [!Ref CustomBigIPRuntimeInit02, ""]]
  useDefaultBucket: !Equals [!Ref s3BucketName, 'aws-quickstart']
  usePublicIpVip: !Equals
    - 'true'
    - !Ref provisionExampleApp
  noCustomImageId: !Equals
    - ''
    - !Ref bigIpImageId
  provisionExampleApp: !Equals
    - !Ref provisionExampleApp
    - 'true'
Metadata:
  QuickStartDocumentation:
    EntrypointName: "Launch into an existing VPC"
  'AWS::CloudFormation::Interface':
    ParameterGroups:
      - Label:
          default: Deployment configuration
        Parameters:
          - uniqueString
      - Label:
          default: Network configuration
        Parameters:
          - vpc
          - peerConfigSyncAddr
          - publicSubnet1ID
          - publicSubnet1SelfAddress
          - privateSubnet1ID
          - privateSubnet1SelfAddress
          - publicSubnet2ID
          - publicSubnet2SelfAddress
          - privateSubnet2ID
          - privateSubnet2SelfAddress
          - privateSubnet3ID
          - privateSubnet4ID
      - Label:
          default: Amazon EC2 configuration
        Parameters:
          - sshKey
          - restrictedSrcAddressMgmt
          - restrictedSrcAddressApp
      - Label:
          default: BIG-IP configuration
        Parameters:
          - bigIpInstanceType
          - bigIpImageId
          - bigIpVersion
          - bigIpImageName
          - bigIpThroughput
          - CustomBigIPRuntimeInit01
          - CustomBigIPRuntimeInit02
          - bigIpRuntimeInitPackageUrl
          - cfeS3Bucket
          - cfeVipTag
          - cfeTag
          - secretArn
      - Label:
          default: Resources tags
        Parameters:
          - application
          - cost
          - environment
          - group
          - owner
      - Label:
          default: Provision example application
        Parameters:
          - provisionExampleApp
          - appDockerImageName
          - publicSubnet1VipAddress
          - publicSubnet2VipAddress
      - Label:
          default: Templates location
        Parameters:
          - s3BucketName
          - s3BucketRegion
          - s3KeyPrefix
    ParameterLabels:
      appDockerImageName:
        default: Application Docker image name
      application:
        default: Application
      bigIpImageName:
        default: F5 BIG-IP performance type (PAYG)
      bigIpImageId:
        default: BIG-IP image ID
      bigIpInstanceType:
        default: AWS instance type
      CustomBigIPRuntimeInit01:
        default: BIG-IP Runtime Init config
      CustomBigIPRuntimeInit02:
        default: BIG-IP Runtime Init config
      bigIpRuntimeInitPackageUrl:
        default: BIG-IP Runtime Init Package URL
      bigIpThroughput:
        default: BIG-IP VE throughput (PAYG)
      bigIpVersion:
        default: BIG-IP VE version
      cfeS3Bucket:
        default: CFE S3 bucket
      cfeTag:
        default: CFE deployment tag value
      cfeVipTag:
        default: CFE VIP tag value
      cost:
        default: Cost center
      environment:
        default: Environment
      group:
        default: Group
      owner:
        default: Owner
      peerConfigSyncAddr:
        default: Static self IP address for peer device
      provisionExampleApp:
        default: Provision example application
      publicSubnet1SelfAddress:
        default: BIG-IP address for public subnet in Availability Zone 1
      publicSubnet2SelfAddress:
        default: BIG-IP address for public subnet in Availability Zone 2
      privateSubnet1ID:
        default: Private subnet Availability Zone 1
      privateSubnet2ID:
        default: Private subnet Availability Zone 2
      privateSubnet3ID:
        default: Private subnet Availability Zone 1
      privateSubnet4ID:
        default: Private subnet Availability Zone 2
      restrictedSrcAddressMgmt:
        default: Restricted source address to BIG-IP management
      restrictedSrcAddressApp:
        default: Restricted source address to application
      s3BucketName:
        default: S3 bucket where templates are located
      s3BucketRegion:
        default: Region where S3 bucket is located
      s3KeyPrefix:
        default: S3 key prefix
      secretArn:
        default: ARN of Secrets Manager secret
      sshKey:
        default: EC2 key pair to enable SSH access to the BIG-IP instance
      vpc:
        default: VPC ID
      uniqueString:
        default: Unique string value that gets appended to cloud resource names
  Version: 1.0.0
Parameters:
  appDockerImageName:
    Default: f5devcentral/f5-demo-httpd:latest
    Description: Application Docker image name
    Type: String
  application:
    Default: f5app
    Description: Name of the application tag
    Type: String
  bigIpImageId:
    ConstraintDescription: Must be a valid AMI ID.
    Default: ''
    Description: 'Provide the AMI ID to deploy using a custom BIG-IP image. Unless specifically required, leave the default 'OPTIONAL' value.
    MaxLength: 255
    MinLength: 0
    Type: String
  bigIpImageName:
    AllowedValues:
      - Best
      - AdvancedWaf
      - AllTwoBootLocations
    ConstraintDescription: Must be a valid F5 BIG-IP VE image type.
    Default: Best
    Description: F5 BIG-IP performance type.
    Type: String
  bigIpInstanceType:
    AllowedValues:
      - m3.2xlarge
      - m4.xlarge
      - m4.2xlarge
      - m4.4xlarge
      - m4.10xlarge
      - m5.large
      - m5.xlarge
      - m5.2xlarge
      - m5.4xlarge
      - c3.4xlarge
      - c3.8xlarge
      - c4.4xlarge
      - c4.8xlarge
      - c5.large
      - c5.xlarge
      - c5.2xlarge
      - c5.4xlarge
      - cc2.8xlarge
      - c5n.2xlarge
      - c5n.4xlarge
    ConstraintDescription: Must be a valid EC2 instance type for BIG-IP
    Default: m5.2xlarge
    Description: AWS instance type
    Type: String
  bigIpThroughput:
    AllowedValues:
      - 25Mbps
      - 200Mbps
      - 1000Mbps
      - 3000Mbps
      - 5000Mbps
      - 10000Mbps
    ConstraintDescription: The BIG-IP throughput. 
    Default: 1000Mbps
    Description: Maximum amount of throughput for BIG-IP VE.
    Type: String
  CustomBigIPRuntimeInit01:
    Description: '(Optional) Alternate URL to the bigip-runtime-init configuration file in YAML
     or JSON format, or an escaped JSON string to use for f5-bigip-runtime-init configuration.'
    Type: String
    Default: ""
  CustomBigIPRuntimeInit02:
    Description: '(Optional) Alternate URL to the bigip-runtime-init configuration file in YAML
     or JSON format, or an escaped JSON string to use for f5-bigip-runtime-init configuration.'
    Type: String
    Default: ""
  bigIpRuntimeInitPackageUrl:
    Description: 'URL for the F5 BIG-IP Runtime Init Package install script.'
    Type: String
    Default: 'https://cdn.f5.com/product/cloudsolutions/f5-bigip-runtime-init/v1.4.1/dist/f5-bigip-runtime-init-1.4.1-1.gz.run'
  bigIpVersion:
    AllowedValues:
      - 16-1-2-1-0010
      - 14-1-4-5-007
    Default: 16-1-2-1-0010
    Description: Version of BIG-IP to deploy.
    Type: String
  cfeS3Bucket:
    ConstraintDescription: 'S3 bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).'
    Default: ""
    Description: 'S3 bucket name used by cloud failover extension.'
    Type: String
  cfeTag:
    Description: Cloud failover deployment tag value.
    Type: String
    Default: aws_quickstart
  cfeVipTag:
    Description: Cloud failover VIP tag value. Provides private IP addresses to assign to VIP public IP address.
    Type: String
    Default: '10.0.20.101,10.0.10.101'
  cost:
    Default: f5cost
    Description: Cost center tag.
    Type: String
  environment:
    Default: f5env
    Description: Environment tag.
    Type: String
  group:
    Default: f5group
    Description: Group tag.
    Type: String
  owner:
    Default: f5owner
    Description: Owner tag.
    Type: String
  peerConfigSyncAddr:
    Default: 10.0.10.11
    Description: The static self IP address of the remote host. Leave empty if not configuring peering with a remote host on this device.
    Type: String
  privateSubnet1ID:
    Description: Private subnet 1 ID.
    Type: AWS::EC2::Subnet::Id
  privateSubnet1SelfAddress:
    AllowedPattern: '^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$'
    ConstraintDescription: IP address parameter must be in the form x.x.x.x.
    Description: Private subnet 1 IP address.
    Default: 10.0.11.11
    Type: String
  privateSubnet2ID:
    Description: Private subnet 2 ID.
    Type: AWS::EC2::Subnet::Id
  privateSubnet3ID:
    Description: Private subnet 2 ID.
    Type: AWS::EC2::Subnet::Id
  privateSubnet4ID:
    Description: Private subnet 2 ID.
    Type: AWS::EC2::Subnet::Id
  privateSubnet2SelfAddress:
    AllowedPattern: '^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$'
    ConstraintDescription: IP address parameter must be in the form x.x.x.x.
    Description: Private subnet 2 IP address.
    Default: 10.0.21.11
    Type: String
  provisionExampleApp:
    AllowedValues:
      - 'true'
      - 'false'
    Default: 'false'
    Description: Flag to deploy the demo web application.
    Type: String
  publicSubnet1ID:
    Description: Public subnet 1 ID.
    Type: AWS::EC2::Subnet::Id
  publicSubnet1SelfAddress:
    AllowedPattern: '^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$'
    ConstraintDescription: IP address parameter must be in the form x.x.x.x.
    Description: Public subnet 1 IP address.
    Default: 10.0.10.11
    Type: String
  publicSubnet1VipAddress:
    AllowedPattern: '^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$'
    ConstraintDescription: IP address parameter must be in the form x.x.x.x.
    Description: Public subnet 1 external service IP address.
    Default: 10.0.10.101
    Type: String
  publicSubnet2ID:
    Description: Public subnet 2 ID.
    Type: AWS::EC2::Subnet::Id
  publicSubnet2SelfAddress:
    AllowedPattern: '^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$'
    ConstraintDescription: IP address parameter must be in the form x.x.x.x.
    Description: Private subnet 2 IP address.
    Default: 10.0.20.11
    Type: String
  publicSubnet2VipAddress:
    AllowedPattern: '^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$'
    ConstraintDescription: IP address parameter must be in the form x.x.x.x.
    Description: Public subnet 2 external service IP address.
    Default: 10.0.20.101
    Type: String
  restrictedSrcAddressMgmt:
    AllowedPattern: '(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})/(\d{1,2})'
    ConstraintDescription: Must be a valid IP CIDR range of the form x.x.x.x/x.
    Description: '(Required) The IP address range used to SSH and access BIG-IP management port.
      Restrict to your client IP. Ex. X.X.X.X/32. WARNING - For evaluation purposes only. Production should never have management interface exposed to Internet.'
    MaxLength: '18'
    MinLength: '9'
    Type: String
  restrictedSrcAddressApp:
    AllowedPattern: '(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})/(\d{1,2})'
    ConstraintDescription: Must be a valid IP CIDR range of the form x.x.x.x/x.
    Description: '(Required) The IP address range used to access web traffic
      (80/443) to the EC2 instances.'
    MaxLength: '18'
    MinLength: '9'
    Type: String
  s3BucketName:
    AllowedPattern: '^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$'
    ConstraintDescription: 'S3 bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).'
    Default: aws-quickstart
    Description: 'S3 bucket name for the modules. S3 bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).'
    Type: String
  s3BucketRegion:
    Default: us-east-1
    Description: 'Region where the Quick Start S3 bucket (s3BucketName) is hosted. When using your own bucket, you must specify this value.'
    Type: String
  s3KeyPrefix:
    AllowedPattern: '^[0-9a-zA-Z-/_.-]*$'
    ConstraintDescription: 'Use defaults unless customizing templates and assests that require alternate location. Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/).'
    Default: quickstart-f5-big-ip-virtual-edition-ha/
    Description: 'S3 key prefix for the Quick Start assets. Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/).'
    Type: String
  secretArn:
    Default: ''
    Description: ARN of Secrets Manager secret.
    Type: String
  sshKey:
    Description: EC2 key pair to enable SSH access to EC2 instances that include BIG-IP, bastion, and demo application instances.
    Type: 'AWS::EC2::KeyPair::KeyName'
  uniqueString:
    AllowedPattern: ^[a-zA-Z][a-zA-Z0-9]{1,11}$
    ConstraintDescription: Must contain between 1 and 12 alphanumeric characters with first character as a letter.
    Default: myUniqStr
    Description: Unique string used when creating object names or tags.
    Type: String
  vpc:
    Description: VPC ID for the deployment.
    Type: AWS::EC2::VPC::Id
Resources:
  Access:
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL:
        !Sub
        - https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${s3KeyPrefix}templates/modules/access/access.yaml
        - S3Region: !If [useDefaultBucket, !Ref AWS::Region, !Ref s3BucketRegion]
          S3Bucket: !If [useDefaultBucket, !Sub '${s3BucketName}-${AWS::Region}', !Ref s3BucketName]
      Parameters:
        application: !Ref application
        cost: !Ref cost
        environment: !Ref environment
        group: !Ref group
        owner: !Ref owner
        s3Bucket: !Ref cfeS3Bucket
        secretArn: !Ref secretArn
        solutionType: failover
        uniqueString: !Ref uniqueString
  Dag:
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL:
        !Sub
        - https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${s3KeyPrefix}templates/modules/dag/dag.yaml
        - S3Region: !If [useDefaultBucket, !Ref AWS::Region, !Ref s3BucketRegion]
          S3Bucket: !If [useDefaultBucket, !Sub '${s3BucketName}-${AWS::Region}', !Ref s3BucketName]
      Parameters:
        application: !Ref application
        cost: !Ref cost
        createAppSecurityGroup: 'true'
        createFailoverIngress: 'true'
        environment: !Ref environment
        group: !Ref group
        numberPublicExternalIpAddresses: !If [usePublicIpVip, 3, 2]
        numberPublicMgmtIpAddresses: 0
        owner: !Ref owner
        restrictedSrcAddressMgmt: !Ref restrictedSrcAddressMgmt
        restrictedSrcAddressApp: !Ref restrictedSrcAddressApp
        cfeTag: !Ref cfeTag
        cfeVipTag: !Ref cfeVipTag
        restrictedSrcPort: 443
        vpc: !Ref vpc
        uniqueString: !Ref uniqueString
  BigipInstance01:
    DependsOn: Access
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL:
        !Sub
        - https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${s3KeyPrefix}templates/modules/bigip-standalone/bigip-standalone.yaml
        - S3Region: !If [useDefaultBucket, !Ref AWS::Region, !Ref s3BucketRegion]
          S3Bucket: !If [useDefaultBucket, !Sub '${s3BucketName}-${AWS::Region}', !Ref s3BucketName]
      Parameters:
        bigIpInstanceProfile: !GetAtt [Access, Outputs.bigIpInstanceProfile]
        bigIpRuntimeInitConfig: !If
          - CustomConfig1
          - !Ref CustomBigIPRuntimeInit01
          - !Sub
            - "https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${s3KeyPrefix}declarations/runtime-init-conf-2nic-payg-instance01.yaml"
            - S3Region: !If [useDefaultBucket, !Ref AWS::Region, !Ref s3BucketRegion]
              S3Bucket: !If [useDefaultBucket, !Sub '${s3BucketName}-${AWS::Region}', !Ref s3BucketName]

        bigIpRuntimeInitPackageUrl: !Ref bigIpRuntimeInitPackageUrl
        cfeS3Bucket: !Ref cfeS3Bucket
        cfeTag: !Ref cfeTag
        imageId: !If [noCustomImageId, !FindInMap [!FindInMap [VERSION, !Ref bigIpVersion, REGIONMAP], !Ref 'AWS::Region', !FindInMap [AWSBigipThroughput, !Ref bigIpThroughput, !Ref bigIpImageName]], !Ref bigIpImageId]
        externalPrimaryPublicId: !GetAtt [Dag, Outputs.bigIpExternalEipAllocationId01]
        externalPublicIpIds: !If [usePublicIpVip, !GetAtt [Dag, Outputs.bigIpExternalEipAllocationId03], '']
        externalSecurityGroupId: !GetAtt [Dag, Outputs.bigIpExternalSecurityGroup]
        externalSelfIp: !Ref publicSubnet1SelfAddress
        externalServiceIps: !Ref publicSubnet1VipAddress
        externalSubnetId: !Ref publicSubnet1ID
        instanceType: !Ref bigIpInstanceType
        internalSubnetId: !Ref 'AWS::NoValue'
        mgmtPublicIpId: ''
        mgmtSecurityGroupId: !GetAtt [Dag, Outputs.bigIpExternalSecurityGroup]
        mgmtSelfIp: !Ref privateSubnet1SelfAddress
        mgmtSubnetId: !Ref privateSubnet1ID
        numSecondaryPrivateIpAddress: !If [usePublicIpVip, 1, 0]
        peerConfigSyncAddr: ''
        sshKey: !Ref sshKey
        uniqueString: !Ref uniqueString
        QSS3BucketName: !Ref s3BucketName
        QSS3KeyPrefix: !Ref s3KeyPrefix
  BigipInstance02:
    DependsOn: Access
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL:
        !Sub
        - https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${s3KeyPrefix}templates/modules/bigip-standalone/bigip-standalone.yaml
        - S3Region: !If [useDefaultBucket, !Ref AWS::Region, !Ref s3BucketRegion]
          S3Bucket: !If [useDefaultBucket, !Sub '${s3BucketName}-${AWS::Region}', !Ref s3BucketName]
      Parameters:
        bigIpInstanceProfile: !GetAtt [Access, Outputs.bigIpInstanceProfile]
        bigIpRuntimeInitConfig: !If
          - CustomConfig2
          - !Ref CustomBigIPRuntimeInit02
          - !Sub
            - "https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${s3KeyPrefix}declarations/runtime-init-conf-2nic-payg-instance02.yaml"
            - S3Region: !If [useDefaultBucket, !Ref AWS::Region, !Ref s3BucketRegion]
              S3Bucket: !If [useDefaultBucket, !Sub '${s3BucketName}-${AWS::Region}', !Ref s3BucketName]
        bigIpRuntimeInitPackageUrl: !Ref bigIpRuntimeInitPackageUrl
        imageId: !If [noCustomImageId, !FindInMap [!FindInMap [VERSION, !Ref bigIpVersion, REGIONMAP], !Ref 'AWS::Region', !FindInMap [AWSBigipThroughput, !Ref bigIpThroughput, !Ref bigIpImageName]], !Ref bigIpImageId]
        cfeTag: !Ref cfeTag
        externalPrimaryPublicId: !GetAtt [Dag, Outputs.bigIpExternalEipAllocationId02]
        externalPublicIpIds: ''
        externalSecurityGroupId: !GetAtt [Dag, Outputs.bigIpExternalSecurityGroup]
        externalSelfIp: !Ref publicSubnet2SelfAddress
        externalServiceIps: !Ref publicSubnet2VipAddress
        externalSubnetId: !Ref publicSubnet2ID
        instanceType: !Ref bigIpInstanceType
        internalSubnetId:  !Ref 'AWS::NoValue'
        mgmtPublicIpId: ''
        mgmtSecurityGroupId: !GetAtt [Dag, Outputs.bigIpExternalSecurityGroup]
        mgmtSelfIp: !Ref privateSubnet2SelfAddress
        mgmtSubnetId: !Ref privateSubnet2ID
        numSecondaryPrivateIpAddress: 0
        peerConfigSyncAddr: !Ref peerConfigSyncAddr
        sshKey: !Ref sshKey
        uniqueString: !Ref uniqueString
        QSS3BucketName: !Ref s3BucketName
        QSS3KeyPrefix: !Ref s3KeyPrefix
  Application01:
    Type: 'AWS::CloudFormation::Stack'
    Condition: provisionExampleApp
    Properties:
      TemplateURL:
        !Sub
        - https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${s3KeyPrefix}templates/modules/application/application.yaml
        - S3Region: !If [useDefaultBucket, !Ref AWS::Region, !Ref s3BucketRegion]
          S3Bucket: !If [useDefaultBucket, !Sub '${s3BucketName}-${AWS::Region}', !Ref s3BucketName]
      Parameters:
        appDockerImageName: !Ref 'appDockerImageName'
        application: !Ref 'application'
        applicationSubnet: !Ref privateSubnet3ID
        appSecurityGroupId: !GetAtt [Dag, Outputs.appSecurityGroupId]
        cost: !Ref 'cost'
        environment: !Ref 'environment'
        group: !Ref 'group'
        sshKey: !Ref 'sshKey'
        uniqueString: !Ref uniqueString
  Application02:
    Type: 'AWS::CloudFormation::Stack'
    Condition: provisionExampleApp
    Properties:
      TemplateURL:
        !Sub
        - https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${s3KeyPrefix}templates/modules/application/application.yaml
        - S3Region: !If [useDefaultBucket, !Ref AWS::Region, !Ref s3BucketRegion]
          S3Bucket: !If [useDefaultBucket, !Sub '${s3BucketName}-${AWS::Region}', !Ref s3BucketName]
      Parameters:
        appDockerImageName: !Ref 'appDockerImageName'
        application: !Ref 'application'
        applicationSubnet: !Ref privateSubnet4ID
        appSecurityGroupId: !GetAtt [Dag, Outputs.appSecurityGroupId]
        cost: !Ref 'cost'
        environment: !Ref 'environment'
        group: !Ref 'group'
        sshKey: !Ref 'sshKey'
        uniqueString: !Ref uniqueString
Outputs:
  access:
    Description: Access nested stack name.
    Value: !GetAtt [Access, Outputs.stackName]
  applicationPublicIp:
    Condition: usePublicIpVip
    Description: Application VIP public IP address.
    Value: !GetAtt [Dag, Outputs.bigIpExternalEipAddress03]
  bigipInstance01:
    Description: BIG-IP standalone nested stack name.
    Value: !GetAtt [BigipInstance01, Outputs.stackName]
  bigipInstance02:
    Description: BIG-IP standalone nested stack name.
    Value: !GetAtt [BigipInstance02, Outputs.stackName]
  bigipInstanceMgmtPrivateIp01:
    Description: Private management IP address for BIG-IP instance 01.
    Value: !GetAtt [BigipInstance01, Outputs.bigIpManagementInterfacePrivateIp]
  bigipInstanceMgmtPrivateIp02:
    Description: Private management IP address for BIG-IP instance 02.
    Value: !GetAtt [BigipInstance02, Outputs.bigIpManagementInterfacePrivateIp]
  dag:
    Description: DAG nested stack name.
    Value: !GetAtt [Dag, Outputs.stackName]
  stackName:
    Description: Workload nested stack name.
    Value: !Ref "AWS::StackName"
